{"version":3,"sources":["utils/axios.js","scripts/views/login/index.js"],"names":["token","axios","defaults","baseURL","headers","common","post","interceptors","request","use","config","msg","sessionStorage","loading","console","log","error","offline","Promise","reject","response","setTimeout","data","hide","success","code","history","push","fail","timer","cReg","pReg","Login","checkPhone","val","test","setState","pFlag","checkCode","phone","state","value","cFlag","sendCode","then","res","timeCount","tologin","type","toHome","count","txt","this","setInterval","clearInterval","className","onClick","placeholder","clear","ref","el","onChange","inline","id","disabled","Component"],"mappings":"8LAKIA,EAAQ,GAEZC,IAAMC,SAASC,QAAU,8BACzBF,IAAMC,SAASE,QAAQC,OAAvB,MAAyCL,EACzCC,IAAMC,SAASE,QAAQE,KAAK,gBAAkB,oCA0B9CL,IAAMM,aAAaC,QAAQC,KAAI,SAAUC,GAvBlC,IAAsBC,EA6B3B,OAHAX,EAAQY,eAAeZ,MAAUY,eAAeZ,MAAQ,GACxDU,EAAON,QAAP,MAA2BJ,EA3BAW,EA4Bd,8BA3BX,IAAME,QAAQF,EAAK,GAAG,WACpBG,QAAQC,IAAI,wBA2BTL,KAGN,SAAUM,GAjBN,IAAiBL,EAoBtB,OApBsBA,EAmBd,uDAlBR,IAAMM,QAAQN,EAAK,GAmBZO,QAAQC,OAAOH,MAMxBf,IAAMM,aAAaa,SAASX,KAAI,SAAUW,GAWtC,OARAC,YAAW,WAvCR,IAAsBV,IAwCVS,EAASE,KAAKX,IAvC7B,IAAMY,OACN,IAAMC,QAAQb,EAAK,KAwCjB,KACqB,OAApBS,EAASE,KAAKG,MACfC,IAAQC,KAAK,UAGRP,KAEN,SAAUJ,GA5CR,IAAmBL,EA8CtB,OA9CsBA,EA6CZ,sDA5CZ,IAAMY,OACN,IAAMK,KAAKjB,EAAK,GA4CPO,QAAQC,OAAOH,O,4VC9DtBa,EAAQ,KACRC,EAAM,aACNC,EAAO,2BACUC,E,YACjB,aAAc,IAAD,8BACT,+CASJC,WAAa,SAACC,GACVpB,QAAQC,IAAImB,GACRH,EAAKI,KAAKD,GACV,EAAKE,SAAS,CACVC,OAAO,IAGX,EAAKD,SAAS,CACVC,OAAO,KAlBN,EAsBbC,UAAU,SAACb,GACPX,QAAQC,IAAI,EAAKwB,MAAMC,MAAMC,OACxBV,EAAKI,KAAK,EAAKI,MAAMC,MAAMC,QAAQX,EAAKK,KAAKV,GAC9C,EAAKW,SAAS,CACVM,OAAM,KAGV5B,QAAQC,IAAI,KACZ,EAAKqB,SAAS,CACVM,OAAM,MA/BL,EAqCbC,SAAS,WACL,IAAMJ,EAAO,EAAKA,MAAMC,MAAMC,MAC9BxC,IAAMK,KAAK,iBAAiB,CAACiC,UAAQK,MAAK,SAAAC,GACtC/B,QAAQC,IAAI8B,MAEhB,EAAKC,aA1CI,EAsEbC,QAAS,WACLjC,QAAQC,IAAI,EAAKwB,MAAMC,MAAMC,OAC7B3B,QAAQC,IAAI,EAAKU,KAAKe,MAAMC,OAC5B,IAAMF,EAAO,EAAKA,MAAMC,MAAMC,MACxBhB,EAAM,EAAKA,KAAKe,MAAMC,MAC5BxC,IAAMK,KAAK,mBAAmB,CAACiC,QAAMd,SAAOmB,MAAK,SAAAC,GAC7C/B,QAAQC,IAAI8B,GACPA,EAAIvB,KAAK0B,MACVpC,eAAeZ,MAAO6C,EAAIvB,KAAKtB,MAC/B0B,IAAQC,KAAK,UAEbf,eAAeZ,MAAO,OAjFrB,EAsFbiD,OAAQ,WACJvB,IAAQC,KAAK,UArFb,EAAKa,MAAM,CACPH,OAAO,EACPK,OAAO,EACPQ,MAAO,GACPC,IAAK,kCANA,E,yEA6CA,IAAD,OACRC,KAAKhB,SAAS,CACVc,QAASE,KAAKZ,MAAMU,MACpBC,IAAI,qBAAD,OAAQC,KAAKZ,MAAMU,OACtBb,OAAM,IAEVR,EAAMwB,aAAY,WACX,EAAKb,MAAMU,MAAQ,EAClB,EAAKd,SAAS,CACVc,QAAS,EAAKV,MAAMU,MACpBC,IAAI,qBAAD,OAAQ,EAAKX,MAAMU,OACtBb,OAAM,KAGViB,cAAczB,GACd,EAAKO,SAAS,CACVc,MAAO,GACPC,IAAI,iCACJd,OAAM,OAGf,O,+BAwBE,IAAD,SAKAe,KAAKZ,MAHLH,EAFA,EAEAA,MACAK,EAHA,EAGAA,MACAS,EAJA,EAIAA,IAEJ,OACI,yBAAKI,UAAU,SACX,2BACI,4BACA,gCACI,uBAAMP,KAAK,OAAOQ,QAASJ,KAAKH,SAChC,uBAAMD,KAAK,WAAWO,UAAU,eAGxC,4BACA,2BACA,0DAEA,4BACA,2BACI,2BACI,uBACIP,KAAK,SACLS,YAAY,uCACZC,OAAK,EACLC,IAAK,SAAAC,GAAE,OAAI,EAAKrB,MAAQqB,GACxBC,SAAUT,KAAKnB,YALnB,uBAQJ,4BACA,2BACI,uBACIe,KAAK,SACLS,YAAY,uCACZC,OAAK,EACLC,IAAK,SAAAC,GAAE,OAAI,EAAKnC,KAAOmC,GACvBC,SAAUT,KAAKd,WALnB,sBAOA,uBACIU,KAAK,UACLc,QAAM,EACNC,GAAG,WACHC,SAAU3B,EACVmB,QAASJ,KAAKT,UAChBQ,IAGN,4BACA,uBACIY,GAAG,YACHf,KAAK,UACLgB,SAAUtB,EACVc,QAAW,WAAM,EAAKT,YAJ1B,kC,GA5IekB","file":"static/js/17.fb0bb21e.chunk.js","sourcesContent":["\r\nimport axios from \"axios\";\r\nimport {Toast} from \"antd-mobile\"\r\nimport {history} from \"./history\";\r\n\r\nvar token = \"\";\r\n// axios.defaults.baseURL = \"http://localhost:2021/\"   // 基路径\r\naxios.defaults.baseURL = \"http://dengchuang.top:2021/\"   // 基路径\r\naxios.defaults.headers.common['token'] = token;     // token 为 空\r\naxios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';\r\n\r\n//封装对应的 成功 失败提示 在下面调用\r\nexport function loadingToast(msg) {\r\n    Toast.loading(msg, 3, () => {\r\n      console.log('Load complete !!!');\r\n    });\r\n}\r\nexport function successToast(msg) {\r\n    Toast.hide();\r\n    Toast.success(msg, 1);\r\n}\r\n\r\nexport function failToast(msg) {\r\n  Toast.hide();\r\n  Toast.fail(msg, 1);\r\n}\r\n\r\nexport function offline(msg) {\r\n  Toast.offline(msg, 1);\r\n}\r\n\r\n\r\n\r\n// axios 拦截器   Interceptors\r\n// 请求 request 拦截器   请求之前业务逻辑 配置 data /headers\r\naxios.interceptors.request.use(function (config) {\r\n  // 请求发送之前做的事情\r\n  \r\n  token = sessionStorage.token ?   sessionStorage.token : \"\";\r\n  config.headers['token']  = token;\r\n  loadingToast(\"努力加载...\");\r\n  return config;\r\n\r\n  \r\n}, function (error) {\r\n  // 请求发送 失败 \r\n  offline(\"请求失败---网络错误!\")\r\n  return Promise.reject(error);\r\n  \r\n});\r\n\r\n\r\n// 响应 response 拦截器   根据返回的状态码 做对应的业务逻辑 \r\naxios.interceptors.response.use(function (response) {\r\n    // 获取到响应数据做的事情\r\n    // console.log(response)\r\n    setTimeout(()=>{\r\n      successToast(response.data.msg);\r\n      \r\n    },1000);\r\n    if(response.data.code==\"400\"){\r\n      history.push(\"/login\");\r\n    };\r\n    \r\n    return response;\r\n\r\n  }, function (error) {\r\n    failToast(\"服务器error-响应失败!!!\");\r\n    return Promise.reject(error);\r\n});\r\n\r\n\r\n\r\n\r\nexport {axios}\r\n\r\n","import React , {Component} from \"react\";\r\nimport \"./index.scss\";\r\nimport {Icon,WingBlank, WhiteSpace,List,InputItem,Button} from \"antd-mobile\";\r\nimport { history } from \"~/history.js\";\r\nimport { axios } from \"~/axios.js\";\r\n\r\nvar timer = null;\r\nvar cReg =/^[0-9]{4}$/\r\nvar pReg = /^1(3|5|6|7|8|9)[0-9]{9}$/\r\nexport default class Login extends Component {\r\n    constructor(){\r\n        super()\r\n        this.state={\r\n            pFlag: true,\r\n            cFlag: true,\r\n            count: 10,\r\n            txt: \"发送验证码\"\r\n\r\n        }\r\n    };\r\n    checkPhone = (val) => {\r\n        console.log(val)\r\n        if (pReg.test(val)) {\r\n            this.setState({\r\n                pFlag: false\r\n            })\r\n        } else {\r\n            this.setState({\r\n                pFlag: true\r\n            })\r\n        }\r\n    };\r\n    checkCode=(code)=>{\r\n        console.log(this.phone.state.value)\r\n        if( (pReg.test(this.phone.state.value)&&cReg.test(code)) ){\r\n            this.setState({\r\n                cFlag:false\r\n            })\r\n        }else{\r\n            console.log(231)\r\n            this.setState({\r\n                cFlag:true\r\n            }) \r\n        }\r\n\r\n    };\r\n    //发送验证码\r\n    sendCode=()=>{\r\n        const phone =this.phone.state.value\r\n        axios.post(\"react/sendCode\",{phone}).then(res=>{\r\n            console.log(res)\r\n        });\r\n        this.timeCount();\r\n    }\r\n\r\n    timeCount() {\r\n        this.setState({\r\n            count: --this.state.count,\r\n            txt: `倒计时${this.state.count}`,\r\n            pFlag:true\r\n        })\r\n        timer=setInterval(() => {\r\n            if(this.state.count > 0){\r\n                this.setState({\r\n                    count: --this.state.count,\r\n                    txt: `倒计时${this.state.count}`,\r\n                    pFlag:true\r\n                })\r\n            }else{\r\n                clearInterval(timer)\r\n                this.setState({\r\n                    count: 10,\r\n                    txt: `发送验证码`,\r\n                    pFlag:false\r\n                })\r\n            }\r\n        }, 1000);\r\n\r\n    };\r\n    //登录\r\n    tologin =()=>{\r\n        console.log(this.phone.state.value)\r\n        console.log(this.code.state.value)\r\n        const phone =this.phone.state.value\r\n        const code =this.code.state.value\r\n        axios.post(\"/react/checkCode\",{phone,code}).then(res=>{\r\n            console.log(res)\r\n            if(!!res.data.type){\r\n                sessionStorage.token =res.data.token\r\n                history.push(\"/main\")\r\n            }else{\r\n                sessionStorage.token =\"\"\r\n            }\r\n        })\r\n    };\r\n    //跳转主页\r\n    toHome =()=>{\r\n        history.push(\"/main\")\r\n    };\r\n\r\n    render(){\r\n        var {\r\n            pFlag,\r\n            cFlag,\r\n            txt\r\n        } = this.state\r\n        return (\r\n            <div className=\"login\">\r\n                <WingBlank>\r\n                    <WhiteSpace/>\r\n                    <header>\r\n                        <Icon type=\"left\" onClick={this.toHome} />\r\n                        <Icon type=\"ellipsis\" className=\"ellipsis\" />  \r\n                    </header>\r\n                </WingBlank>\r\n                <WhiteSpace />\r\n                <WingBlank>\r\n                <h2> 手机登录</h2>\r\n                </WingBlank>\r\n                <WhiteSpace />\r\n                <WingBlank>\r\n                    <List>\r\n                        <InputItem\r\n                            type=\"number\"\r\n                            placeholder=\"请输入手机号\"\r\n                            clear\r\n                            ref={el => this.phone = el}\r\n                            onChange={this.checkPhone}\r\n                        >手机号</InputItem>\r\n                    </List>\r\n                    <WhiteSpace />\r\n                    <List>\r\n                        <InputItem\r\n                            type=\"number\"\r\n                            placeholder=\"请输入验证码\"\r\n                            clear\r\n                            ref={el => this.code = el}\r\n                            onChange={this.checkCode}\r\n                        >验证码</InputItem>\r\n                        <Button\r\n                            type=\"warning\"\r\n                            inline\r\n                            id=\"code-btn\"\r\n                            disabled={pFlag}\r\n                            onClick={this.sendCode}\r\n                        >{txt}</Button>\r\n                    </List>\r\n\r\n                    <WhiteSpace />\r\n                    <Button\r\n                        id=\"login-btn\"\r\n                        type=\"primary\"\r\n                        disabled={cFlag}\r\n                        onClick ={ () =>{this.tologin()} }\r\n                    >点击登录</Button>\r\n                </WingBlank>\r\n\r\n                \r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\n\r\n\r\n// axios({\r\n//     url: \"https://webservice.juanpi.com/api/getGoods?page=1&zy_ids=p8_c4_l4&app_name=zhe&catname=tab_hpdp&flag=tab_hpdp\",\r\n//     method: \"GET\",\r\n//     headers: {\r\n//         \"User-Agent\": 'Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1',\r\n//     }\r\n// }).then(res => {\r\n//     console.log(res)\r\n// })"],"sourceRoot":""}